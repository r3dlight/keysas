import{_,o as a,c as n,e as u,a as s,N as A,g as d,h as B,F as b,r as E,t as f,b as l,d as I,w as C,v as U,i as p,f as Y}from"./index-cbd18d6f.js";import{r as H,u as N,s as V,a as G,g as D,b as $,c as O,i as M}from"./utils-03851a22.js";import{b as m,c as y}from"./index-e311e5e3.js";const T={name:"GenKeypair",props:{CreateKeypairStatus:Boolean},computed:{},data(){return{keys:"",hide:!1}},async mounted(){this.keys=await getKeys()},methods:{async displayKeysasList(){loadStore(),this.keys=await getKeys()}}},q={class:"term"},L=s("br",null,null,-1),z={key:0,class:"animate__animated animate__flash textterm text-success"},J={key:1,class:"animate__animated animate__flash textterm text-danger"},F={key:2,class:"textterm spinner-border text-info"};function W(e,o,c,h,t,i){return a(),n("div",q,[u(" Generating a new signing keypair: "),L,c.CreateKeypairStatus?(a(),n("span",z,"New keypair successfully generated !")):c.CreateKeypairStatus===!1?(a(),n("span",J,"Error while generating the new keypair !")):(a(),n("span",F))])}const j=_(T,[["render",W]]);const Q={name:"AddYubikey",computed:{},data(){return{keys:"",hide:!1}},async mounted(){this.keys=await getKeys()},methods:{async displayKeysasList(){loadStore(),this.keys=await getKeys()}}},X={class:"term"},Z=s("span",{class:"animate__animated animate__flash textterm"},"Not available yet !",-1),ss=[Z];function ts(e,o,c,h,t,i){return a(),n("div",X,ss)}const es=_(Q,[["render",ts]]),as={name:"RevokeYubikey",computed:{},data(){return{keys:"",hide:!1}},async mounted(){this.keys=await getKeys()},methods:{async displayKeysasList(){loadStore(),this.keys=await getKeys()}}},ns={class:"term"},os=s("span",{class:"animate__animated animate__flash textterm"},"Not available yet !",-1),is=[os];function rs(e,o,c,h,t,i){return a(),n("div",ns,is)}const cs=_(as,[["render",rs]]),ls={name:"UpdateKeysas",props:{updateStatus:Boolean},computed:{},data(){return{keys:"",hide:!1}},async mounted(){this.keys=await getKeys()},methods:{async displayKeysasList(){loadStore(),this.keys=await getKeys()}}},us={class:"term"},ds=s("br",null,null,-1),_s={key:0,class:"animate__animated animate__flash textterm text-success"},hs=s("br",null,null,-1),ps={key:1,class:"animate__animated animate__flash textterm text-danger"},ys={key:2,class:"textterm spinner-border text-info"};function ms(e,o,c,h,t,i){return a(),n("div",us,[u(" Updating Keysas station: "),ds,c.updateStatus?(a(),n("span",_s,[u("Keysas successfully updated."),hs,u("Rebooting now !")])):c.updateStatus===!1?(a(),n("span",ps,"Error while updating :'/")):(a(),n("span",ys))])}const ws=_(ls,[["render",ms]]),fs={name:"RebootKeysas",props:{rebootStatus:Boolean},computed:{},data(){return{}},async mounted(){},methods:{}},bs={class:"term"},Ss=s("br",null,null,-1),ks={key:0,class:"animate__animated animate__flash textterm text-success"},gs={key:1,class:"animate__animated animate__flash textterm text-danger"},Ks={key:2,class:"textterm spinner-border text-info"};function xs(e,o,c,h,t,i){return a(),n("div",bs,[u(" Rebooting Keysas station: "),Ss,c.rebootStatus?(a(),n("span",ks,"Success")):c.rebootStatus===!1?(a(),n("span",gs,"Error: can't connect to the Keysas station !")):(a(),n("span",Ks))])}const vs=_(fs,[["render",xs]]),Rs={name:"ShutdownKeysas",props:{shutdownStatus:Boolean},computed:{},data(){return{}},async mounted(){},methods:{}},Ps={class:"term"},As=s("br",null,null,-1),Bs={key:0,class:"animate__animated animate__flash textterm text-success"},Es={key:1,class:"animate__animated animate__flash textterm text-danger"},Is={key:2,class:"textterm spinner-border text-info"};function Cs(e,o,c,h,t,i){return a(),n("div",Ps,[u(" Powering off the Keysas station: "),As,c.shutdownStatus?(a(),n("span",Bs,"Success")):c.shutdownStatus===!1?(a(),n("span",Es,"Error: can't connect to the Keysas station !")):(a(),n("span",Is))])}const Us=_(Rs,[["render",Cs]]),Ys={name:"ExportSSH",props:{exportSSHStatus:Boolean},computed:{},data(){return{}},async mounted(){},methods:{}},Hs={class:"term"},Ns=s("br",null,null,-1),Vs={key:0,class:"animate__animated animate__flash textterm text-success"},Gs=s("br",null,null,-1),Ds={key:1,class:"animate__animated animate__flash textterm text-danger"},$s={key:2,class:"spinner-border text-info"};function Os(e,o,c,h,t,i){return a(),n("div",Hs,[u(" Exporting SSH public key to Keysas station:"),Ns,c.exportSSHStatus?(a(),n("span",Vs,[u("Export successfully done !"),Gs,u("You should change the default password for user keysas now.")])):c.exportSSHStatus===!1?(a(),n("span",Ds,"Error: cannot connect to the Keysas station !")):(a(),n("span",$s))])}const Ms=_(Ys,[["render",Os]]);const Ts={name:"ManageView",components:{NavBar:A,GenKeypair:j,AddYubikey:es,RevokeYubikey:cs,UpdateKeysas:ws,RebootKeysas:vs,ShutdownKeysas:Us,ExportSSH:Ms},computed:{},data(){return{stations:"",db:[],hide:!0,current_keysas:"",current_ip:"",ShowGenKeypair:!1,ShowRevDeviceValidate:!1,ShowAddYubikey:!1,ShowRevYubikey:!1,ShowUpdateKeysas:!1,ShowRebootKeysas:!1,ShowShutdownKeysas:!1,ShowExportSSH:!1,ShowActionButtons:!0,ShowPasswordInit:!1,ShowPasswordSign:!1,reboot_status:void 0,update_status:void 0,shutdown_status:void 0,export_ssh_status:void 0,create_keypair_status:void 0,sign_usb_status:void 0,revoke_usb_status:void 0,password:void 0,passwordError:"",alive:!1,KeysasAlive:void 0,confirmed:!1}},mounted(){m("list_stations").then(e=>{console.log(e),this.stations=JSON.parse(e)}).catch(e=>console.error(e))},onUpdated(){m("list_stations").then(e=>{console.log(e),this.stations=JSON.parse(e)}).catch(e=>console.error(e))},methods:{flush(){this.ShowGenKeypair=!1,this.ShowRevKeypair=!1,this.ShowAddYubikey=!1,this.ShowRevYubikey=!1,this.ShowRevDeviceValidate=!1,this.ShowRevDevice=!1,this.ShowUpdateKeysas=!1,this.ShowRebootKeysas=!1,this.ShowShutdownKeysas=!1,this.ShowExportSSH=!1,this.ShowPasswordGenerateKeypair=!1,this.ShowPasswordSign=!1,this.password=void 0,this.passwordError="",this.confirmed=!1},displayKeysasList(){m("list_stations").then(e=>{console.log(e),this.stations=JSON.parse(e)}).catch(e=>console.error(e))},async removeKeysas(e){this.confirmed=await y("Please confirm",{title:"Remove this Keysas ?",type:"warning"}),this.confirmed==!0&&(await removeKey(e),this.keys=await getKeys(),this.confirmed=!1)},getKeysasIP(e){m("get_station_ip",{name:e}).then(o=>this.current_ip=o).catch(o=>console.error(o))},async rebootKeysas(e){await this.getKeysasIP(e),this.confirmed=await y("Please confirm",{title:"Ready to reboot this Keysas ?",type:"info"}),this.confirmed==!0?(this.reboot_status=await H(this.current_ip),this.confirmed=!1):this.ShowRebootKeysas=!1},async updateKeysas(e){await this.getKeysasIP(e),this.confirmed=await y("This action cannot be reverted. Are you sure?",{title:"Ready to update this Keysas",type:"warning"}),this.confirmed==!0?(this.update_status=await N(this.current_ip),this.confirmed=!1):this.ShowUpdateKeysas=!1},async shutdownKeysas(e){await this.getKeysasIP(e),this.confirmed=await y("Please confirm",{title:"Ready to shutdown this Keysas",type:"info"}),this.confirmed==!0?(this.shutdown_status=await V(this.current_ip),this.confirmed=!1):this.ShowShutdownKeysas=!1},async AddSSHPubKey(e){await this.getKeysasIP(e),this.confirmed=await y("Please confirm",{title:"Ready to export the SSH public key",type:"info"}),this.confirmed==!0?(this.export_ssh_status=await G(this.current_ip),this.confirmed=!1):this.ShowExportSSH=!1},async CreateKeypair(e,o){await this.getKeysasIP(e),this.create_keypair_status=await D(this.current_ip,o)},async SignUSB(e,o){await this.getKeysasIP(e),this.sign_usb_status=await $(this.current_ip,o)},async RevokeUSB(e){await this.getKeysasIP(e),this.revoke_usb_status=await O(this.current_ip)},async onSubmitInit(){await this.getKeysasIP(this.current_keysas),this.confirmed=await y("This action cannot be reverted. Are you sure?",{title:"Ready to initialize this Keysas",type:"warning"});var e=prompt("Enter PKI password");this.confirmed==!0?(this.update_status=await M(this.current_ip,this.current_keysas,e),this.confirmed=!1,this.ShowGenKeypair=!0):this.ShowUpdateKeysas=!1},async onSubmitSign(){this.sign_usb_status=void 0,this.passwordError=this.password.length>7?"":"Password should have been created with at least 8 chars",this.passwordError?console.log("CreateKeypair not called!"):(this.ShowSignKey=!0,await this.SignUSB(this.current_keysas,this.password),this.password=void 0,console.log("sign_usb_status: "+this.sign_usb_status))},isalive(){this.polling=setInterval(()=>{this.statusButton(this.current_keysas)},2e4)},statusButton(e){m("is_alive",{name:e}).then(o=>this.KeysasAlive=o).catch(o=>{console.error(o),this.KeysasAlive=!1})}},beforeUnmount(){clearInterval(this.alive)},created(){this.isalive()}},qs=s("h1",null,"Manage your registered Keysas stations",-1),Ls={class:"box"},zs=s("h5",{class:"text-dark"},"Check the status, update and manage your Keysas stations here.",-1),Js={class:"list-group"},Fs={class:"list-group-item list-group-item transparent"},Ws={class:"btn btn-outline-dark btn-lg shadow"},js=s("i",{class:"bi bi-arrow-right"},null,-1),Qs={class:"btn-group",role:"group"},Xs=["onClick"],Zs=s("span",{class:"bi bi-arrow-counterclockwise"},"Reboot",-1),st=[Zs],tt=["onClick"],et=s("span",{class:"bi bi-arrow-down-circle-fill"}," Shutdown",-1),at=[et],nt=["onClick"],ot=s("span",{class:"bi bi-send"}," Export SSH pubkey",-1),it=[ot],rt=["onClick"],ct=s("span",{class:"bi bi-exclamation-circle"}," Delete",-1),lt=[ct],ut=["onClick"],dt=s("span",{class:"bi bi-arrows-expand"}," More...",-1),_t=[dt],ht={key:0,class:"box animate__animated animate__pulse"},pt={class:"box-small-left"},yt={class:"list-group-item list-group-item-action list-group-item-light"},mt=s("span",null,"Name:",-1),wt={class:"list-group-item list-group-item-action list-group-item-light"},ft=s("span",null,"IP:",-1),bt={key:0,class:"list-group-item list-group-item-action list-group-item-light"},St=s("span",null,"Status: ",-1),kt=s("span",{class:"bi bi-check-square text-success"}," Online",-1),gt=[St,kt],Kt={key:1,class:"list-group-item list-group-item-action list-group-item-light"},xt=s("span",null,"Status: ",-1),vt=s("span",{class:"bi bi-x-square text-danger"}," Offline",-1),Rt=[xt,vt],Pt={key:2,class:"list-group-item list-group-item-action list-group-item-light"},At=s("span",null,"Status: ",-1),Bt=s("span",{class:"bi bi-x-square text-dark"}," Unknown",-1),Et=[At,Bt],It={key:0},Ct={class:"list-group"},Ut={class:"list-group-item list-group-item transparent"},Yt={class:"btn-group",role:"group","aria-label":"Basic outlined example"},Ht=s("span",{class:"bi bi-magic"}," Initialize",-1),Nt=[Ht],Vt=s("span",{class:"bi bi-cart-check"}," Add a Yubikey",-1),Gt=[Vt],Dt=s("span",{class:"bi bi-x-square"}," Revoke a Yubikey",-1),$t=[Dt],Ot=s("span",{class:"bi bi-tools"}," Update this Keysas",-1),Mt=[Ot],Tt={key:1,class:"add-form"},qt={class:"container"},Lt={class:"row"},zt=Y('<div class="col-sm"><div class="tip"><span class="text-info"><i class="bi bi-moon-stars-fill"> Help</i></span><br><span class="tip-text">We need to create a dedicated keypair on this Keysas station to be able to sign output files. No need to create a password to protect this key pair but need for the PKI password </span><br><br><span class="text-warning"><i class="bi bi-exclamation-triangle"> Warning!</i></span><br><span class="tip-text">This will create a new signing keypair and remove any previously created one. Therefore, any previously signed output keys on this Keysas station will be revoked.</span></div></div>',1),Jt={class:"col-sm"},Ft=s("label",{type:"text"},"TODO remove:",-1),Wt={key:0,class:"error"},jt={class:"submit"},Qt=s("button",{class:"send btn btn-outline-success shadow"},[s("i",{class:"bi bi-check-square"}," Do it !")],-1),Xt=s("br",null,null,-1),Zt=s("br",null,null,-1),se={key:0,class:"validate animate__animated animate__zoomIn text-success"},te=s("div",{style:{display:"none"},id:"pwdpopup"},[s("div",null,"Enter PKI password:"),s("input",{id:"pass",type:"password"}),s("button",{onclick:"done()"},"OK")],-1);function ee(e,o,c,h,t,i){const S=d("NavBar"),k=d("GenKeypair"),g=d("AddYubikey"),K=d("RevokeYubikey"),x=d("UpdateKeysas"),v=d("RebootKeysas"),R=d("ShutdownKeysas"),P=d("ExportSSH");return a(),n(b,null,[B(S),qs,s("div",Ls,[zs,s("ul",Js,[(a(!0),n(b,null,E(t.stations,r=>(a(),n("li",Fs,[s("button",Ws,f(r.name),1),js,u(" Â  "),s("div",Qs,[s("button",{class:"btn btn-outline-warning btn-lg shadow",onClick:w=>{i.flush(),t.hide=!1,t.ShowActionButtons=!1,this.current_keysas=r.name,t.reboot_status=void 0,t.ShowRebootKeysas=!0,i.rebootKeysas(r.name)}},st,8,Xs),s("button",{class:"btn btn-outline-primary btn-lg shadow",onClick:w=>{i.flush(),t.hide=!1,t.ShowActionButtons=!1,this.current_keysas=r.name,t.shutdown_status=void 0,t.ShowShutdownKeysas=!0,i.shutdownKeysas(r.name)}},at,8,tt),s("button",{class:"btn btn-outline-info btn-lg shadow",onClick:w=>{i.flush(),t.hide=!1,t.ShowActionButtons=!1,this.current_keysas=r.name,t.export_ssh_status=void 0,t.ShowExportSSH=!0,i.AddSSHPubKey(r.name)}},it,8,nt),s("button",{class:"btn btn-outline-danger btn-lg shadow",onClick:w=>{i.removeKeysas(r),i.flush(),t.hide=!0}},lt,8,rt),s("button",{class:"btn btn-outline-secondary btn-lg shadow",onClick:w=>{t.hide=!t.hide,t.ShowActionButtons=!0,i.flush(),this.current_keysas=r.name,this.current_ip=r.ip,i.getKeysasIP(r.name),this.current_keysas=r.name}},_t,8,ut)])]))),256))])]),t.hide?l("",!0):(a(),n("div",ht,[s("ul",pt,[s("li",yt,[mt,u(" "+f(t.current_keysas),1)]),s("li",wt,[ft,u(" "+f(t.current_ip),1)]),t.KeysasAlive=="true"?(a(),n("li",bt,gt)):l("",!0),t.KeysasAlive=="false"?(a(),n("li",Kt,Rt)):l("",!0),t.KeysasAlive!="false"&&t.KeysasAlive!="true"?(a(),n("li",Pt,Et)):l("",!0)]),t.ShowActionButtons?(a(),n("div",It,[s("ul",Ct,[s("li",Ut,[s("div",Yt,[s("button",{class:"send btn btn-lg btn-outline-info shadow",onClick:o[0]||(o[0]=r=>{i.flush(),t.ShowPasswordInit=!t.ShowPasswordInit})},Nt),s("button",{class:"send btn btn-lg btn-outline-primary shadow",onClick:o[1]||(o[1]=r=>{i.flush(),t.ShowAddYubikey=!t.ShowAddYubikey})},Gt),s("button",{class:"send btn btn-lg btn-outline-warning shadow",onClick:o[2]||(o[2]=r=>{i.flush(),t.ShowRevYubikey=!t.ShowRevYubikey})},$t),s("button",{class:"send btn btn-lg btn-outline-success shadow",onClick:o[3]||(o[3]=r=>{i.flush(),t.ShowUpdateKeysas=!t.ShowUpdateKeysas,t.update_status=void 0,i.updateKeysas(t.current_keysas)})},Mt)])])])])):l("",!0),t.ShowPasswordInit?(a(),n("div",Tt,[s("div",qt,[s("div",Lt,[zt,s("div",Jt,[s("form",{class:"add-form password",onSubmit:o[5]||(o[5]=I((...r)=>i.onSubmitInit&&i.onSubmitInit(...r),["prevent"]))},[Ft,C(s("input",{type:"password",required:"","onUpdate:modelValue":o[4]||(o[4]=r=>t.password=r),placeholder:"8 characters minimum",id:"password"},null,512),[[U,t.password]]),t.passwordError?(a(),n("div",Wt,f(t.passwordError),1)):l("",!0),s("div",jt,[Qt,Xt,Zt,e.show?(a(),n("h3",se,"Done !")):l("",!0)])],32)])])])])):l("",!0),t.ShowGenKeypair?(a(),p(k,{key:2,CreateKeypairStatus:t.create_keypair_status},null,8,["CreateKeypairStatus"])):l("",!0),t.ShowAddYubikey?(a(),p(g,{key:3})):l("",!0),t.ShowRevYubikey?(a(),p(K,{key:4})):l("",!0),t.ShowUpdateKeysas?(a(),p(x,{key:5,updateStatus:t.update_status},null,8,["updateStatus"])):l("",!0),t.ShowRebootKeysas?(a(),p(v,{key:6,rebootStatus:t.reboot_status},null,8,["rebootStatus"])):l("",!0),t.ShowShutdownKeysas?(a(),p(R,{key:7,shutdownStatus:t.shutdown_status},null,8,["shutdownStatus"])):l("",!0),t.ShowExportSSH?(a(),p(P,{key:8,exportSSHStatus:t.export_ssh_status},null,8,["exportSSHStatus"])):l("",!0)])),te],64)}const ie=_(Ts,[["render",ee]]);export{ie as default};
